<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Omnibees Roadmap</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet"/>
<style>
:root {
  --bg: #f4f3ef;
  --white: #ffffff;
  --dark: #1a1a1a;
  --mid: #444;
  --muted: #888;
  --border: #e0ddd6;
  --accent: #1a1a1a;
  --now-bg: #1a1a1a;
  --now-text: #ffffff;
  --next-bg: #ffffff;
  --next-text: #1a1a1a;
  --future-bg: #f4f3ef;
  --future-text: #1a1a1a;
  --risk-red: #e63946;
  --risk-orange: #f4a261;
  --risk-yellow: #e9c46a;
  --progress-bg: #e0ddd6;
  --progress-fill: #1a1a1a;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  background: var(--bg);
  color: var(--dark);
  font-family: 'Inter', sans-serif;
  min-height: 100vh;
}

/* ‚îÄ‚îÄ LOGIN ‚îÄ‚îÄ */
#loginScreen {
  position: fixed; inset: 0;
  background: var(--dark);
  display: flex; align-items: center; justify-content: center;
  z-index: 100;
  transition: opacity .5s, visibility .5s;
}
#loginScreen.hidden { opacity: 0; visibility: hidden; pointer-events: none; }

.login-box {
  text-align: center;
  width: 340px;
}
.login-title {
  font-family: 'Syne', sans-serif;
  font-size: 2.4rem;
  font-weight: 800;
  color: #fff;
  letter-spacing: -1px;
  margin-bottom: 4px;
}
.login-title span { color: #f4a261; }
.login-sub { color: #666; font-size: .85rem; margin-bottom: 40px; }

.login-input {
  width: 100%;
  background: #2a2a2a;
  border: 1px solid #333;
  border-radius: 8px;
  padding: 14px 18px;
  color: #fff;
  font-family: 'Inter', sans-serif;
  font-size: .95rem;
  outline: none;
  text-align: center;
  letter-spacing: 4px;
  margin-bottom: 12px;
  transition: border-color .2s;
}
.login-input:focus { border-color: #f4a261; }
.login-btn {
  width: 100%;
  padding: 14px;
  background: #f4a261;
  color: #1a1a1a;
  border: none;
  border-radius: 8px;
  font-family: 'Syne', sans-serif;
  font-size: .95rem;
  font-weight: 700;
  cursor: pointer;
  transition: opacity .2s;
}
.login-btn:hover { opacity: .88; }
.login-error {
  color: #e63946;
  font-size: .8rem;
  margin-top: 10px;
  display: none;
}
.login-error.show { display: block; }

/* ‚îÄ‚îÄ APP ‚îÄ‚îÄ */
#app { display: none; min-height: 100vh; }

/* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
header {
  background: var(--dark);
  color: #fff;
  padding: 20px 48px;
  display: flex; align-items: center; justify-content: space-between;
  position: sticky; top: 0; z-index: 10;
}
.logo {
  font-family: 'Syne', sans-serif;
  font-size: 1.4rem;
  font-weight: 800;
  letter-spacing: -0.5px;
}
.logo span { color: #f4a261; }
.header-meta { display: flex; align-items: center; gap: 20px; }
.header-date { font-size: .78rem; color: #888; }
.header-refresh-info { font-size: .72rem; color: #555; white-space: nowrap; }
.header-btn {
  background: transparent;
  border: 1px solid #333;
  color: #888;
  padding: 7px 14px;
  border-radius: 6px;
  font-size: .78rem;
  cursor: pointer;
  font-family: 'Inter', sans-serif;
  transition: border-color .2s, color .2s;
}
.header-btn:hover { border-color: #f4a261; color: #f4a261; }

/* ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ */
main { padding: 48px; }

/* ‚îÄ‚îÄ SECTION TITLE ‚îÄ‚îÄ */
.section-label {
  font-family: 'Syne', sans-serif;
  font-size: .7rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 3px;
  color: var(--muted);
  margin-bottom: 16px;
  display: flex; align-items: center; gap: 12px;
}
.section-label::after {
  content: '';
  flex: 1;
  height: 1px;
  background: var(--border);
}

/* ‚îÄ‚îÄ PILLS ‚îÄ‚îÄ */
.meta-pill {
  font-size: .68rem;
  font-weight: 600;
  padding: 4px 10px;
  border-radius: 99px;
  font-family: 'Syne', sans-serif;
  letter-spacing: .5px;
  white-space: nowrap;
  display: inline-block;
  margin-top: 8px;
}
.pill-current { background: var(--dark); color: #fff; }
.pill-next    { background: var(--border); color: var(--dark); }
.pill-future  { background: transparent; border: 1px solid var(--border); color: var(--muted); }
.pill-past    { background: #e8f5e9; color: #2e7d32; border: 1px solid #c8e6c9; }

/* ‚îÄ‚îÄ MATRIX ‚îÄ‚îÄ */
.matrix-wrap {
  overflow-x: auto;
  margin-bottom: 48px;
  padding-bottom: 8px;
}
.matrix-grid {
  display: grid;
  gap: 8px;
  min-width: max-content;
}
/* Header row */
.matrix-squad-header {
  background: transparent;
}
.matrix-col-header {
  background: var(--white);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 16px 20px;
  text-align: center;
}
.matrix-col-header.current {
  background: var(--dark);
  color: #fff;
  border-color: var(--dark);
}
.matrix-col-header.current .meta-col-dates,
.matrix-col-header.current .meta-col-period { color: #aaa; }
.matrix-col-header.past { opacity: 0.75; }
.meta-col-num {
  font-family: 'Syne', sans-serif;
  font-size: 1.3rem;
  font-weight: 800;
  letter-spacing: -0.5px;
}
.meta-col-period {
  font-size: .78rem;
  font-weight: 600;
  color: var(--muted);
  margin-top: 2px;
}
.meta-col-dates {
  font-size: .7rem;
  color: var(--muted);
  margin-top: 2px;
}
/* Squad label column */
.matrix-squad-label {
  background: var(--white);
  border: 1px solid var(--border);
  border-left-width: 4px;
  border-radius: 12px;
  padding: 14px 16px;
  display: flex;
  align-items: center;
  gap: 10px;
  min-width: 180px;
}
.squad-color-dot {
  width: 8px; height: 8px;
  border-radius: 50%;
  flex-shrink: 0;
}
.squad-name-wrap {
  display: flex;
  flex-direction: column;
  gap: 1px;
}
.squad-name {
  font-family: 'Syne', sans-serif;
  font-size: .78rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 1px;
  line-height: 1.3;
}
.squad-name-main {
  font-family: 'Syne', sans-serif;
  font-size: .78rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 1px;
  line-height: 1.2;
}
.squad-name-sub {
  font-family: 'Syne', sans-serif;
  font-size: .65rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: .5px;
  color: var(--dark);
  line-height: 1.2;
}
/* Data cells */
.matrix-cell {
  background: var(--white);
  border: 1px solid var(--border);
  border-radius: 12px;
  overflow: hidden;
  min-height: 60px;
  transition: box-shadow .3s;
}
.matrix-cell.cell-past { opacity: 0.7; background: var(--bg); }
.matrix-cell.cell-future { background: #fafaf8; }
@keyframes cell-flash {
  0%   { box-shadow: inset 0 0 0 3px #f4a261, 0 0 0 4px rgba(244,162,97,.25); }
  70%  { box-shadow: inset 0 0 0 3px #f4a261, 0 0 0 4px rgba(244,162,97,.10); }
  100% { box-shadow: inset 0 0 0 0px transparent, 0 0 0 0px transparent; }
}
.matrix-cell.cell-highlight {
  animation: cell-flash 1.6s ease-out forwards;
}
.matrix-cell-empty {
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 60px;
  color: var(--border);
  font-size: 1.2rem;
}
.squad-count {
  font-size: .7rem;
  color: var(--muted);
  background: var(--bg);
  padding: 2px 8px;
  border-radius: 99px;
  margin-left: auto;
  white-space: nowrap;
}

/* ‚îÄ‚îÄ EPIC ROW ‚îÄ‚îÄ */
.epic-row {
  padding: 12px 18px;
  border-bottom: 1px solid #f5f4f0;
  display: flex; flex-direction: column; gap: 8px;
  border-left: 3px solid transparent;
}
.epic-row:last-child { border-bottom: none; }

/* ‚îÄ‚îÄ STATUS COLOR GROUPS ‚îÄ‚îÄ */
/* Group 0 ‚Äî Live: verde vivo, topo da lista */
.st-live {
  border-left-color: #16a34a;
  background: #f0fdf4;
}
.st-live .epic-status  { background: #dcfce7; color: #15803d; }
.st-live .progress-fill { background: #16a34a; }
.st-live .epic-name    { font-weight: 600; }

/* Group 1 ‚Äî Released: verde m√©dio */
.st-released {
  border-left-color: #22c55e;
  background: #f7fef9;
}
.st-released .epic-status  { background: #dcfce7; color: #16a34a; }
.st-released .progress-fill { background: #22c55e; }

/* Group 2 ‚Äî Pronto para Release: verde suave */
.st-ready-rel {
  border-left-color: #86efac;
}
.st-ready-rel .epic-status  { background: #f0fdf4; color: #15803d; }
.st-ready-rel .progress-fill { background: #4ade80; }

/* Group 3 ‚Äî Em desenvolvimento: laranja constru√ß√£o */
.st-in-dev {
  border-left-color: #f97316;
}
.st-in-dev .epic-status  { background: #fff7ed; color: #c2410c; }
.st-in-dev .progress-fill { background: #f97316; }

/* Group 4 ‚Äî Pronto para desenvolvimento: azul projecto */
.st-ready-dev {
  border-left-color: #60a5fa;
}
.st-ready-dev .epic-status  { background: #eff6ff; color: #1d4ed8; }
.st-ready-dev .progress-fill { background: #60a5fa; }

/* Group 5 ‚Äî An√°lise/Estudo: cinzento, fundo ao fim */
.st-analysis {
  border-left-color: #d1d5db;
  opacity: 0.72;
}
.st-analysis .epic-status  { background: #f3f4f6; color: #6b7280; }
.st-analysis .progress-fill { background: #9ca3af; }

.epic-top {
  display: flex; align-items: flex-start; justify-content: space-between; gap: 8px;
}
.epic-name {
  font-size: .85rem;
  font-weight: 500;
  line-height: 1.35;
  flex: 1;
  word-break: break-word;
  overflow-wrap: break-word;
  min-width: 0;
}
.risk-badge {
  display: flex; align-items: center; gap: 4px;
  font-size: .68rem;
  font-weight: 600;
  padding: 3px 8px;
  border-radius: 4px;
  white-space: nowrap;
  flex-shrink: 0;
}
.risk-unplanned { background: #fce8ea; color: var(--risk-red); }
.risk-atrisk    { background: #fef3e2; color: #c76b00; }
.risk-long      { background: #fefae0; color: #997000; }

.epic-bottom {
  display: flex; align-items: center; gap: 10px;
}
.epic-status {
  font-size: .7rem;
  font-weight: 500;
  padding: 2px 8px;
  border-radius: 4px;
  white-space: nowrap;
}
.progress-bar {
  flex: 1;
  height: 4px;
  background: var(--progress-bg);
  border-radius: 99px;
  overflow: hidden;
}
.progress-fill {
  height: 100%;
  background: var(--dark);
  border-radius: 99px;
  transition: width .4s ease;
}
.progress-pct {
  font-size: .68rem;
  color: var(--muted);
  min-width: 28px;
  text-align: right;
}

/* ‚îÄ‚îÄ LOADING ‚îÄ‚îÄ */
.loading {
  text-align: center;
  padding: 80px;
  color: var(--muted);
}
.spinner {
  width: 28px; height: 28px;
  border: 2px solid var(--border);
  border-top-color: var(--dark);
  border-radius: 50%;
  animation: spin .7s linear infinite;
  margin: 0 auto 14px;
}
@keyframes spin { to { transform: rotate(360deg); } }

/* ‚îÄ‚îÄ ERROR ‚îÄ‚îÄ */
.error-box {
  background: #fce8ea;
  border: 1px solid #f5c0c4;
  border-radius: 10px;
  padding: 20px 24px;
  color: var(--risk-red);
  font-size: .85rem;
  margin-bottom: 24px;
  display: none;
}
.error-box.show { display: block; }

/* ‚îÄ‚îÄ EMPTY ‚îÄ‚îÄ */
.empty-squad {
  padding: 20px 18px;
  font-size: .8rem;
  color: var(--muted);
  text-align: center;
  font-style: italic;
}

/* ‚îÄ‚îÄ LOGO ‚îÄ‚îÄ */
.logo { display: flex; align-items: center; gap: 10px; }
.logo-img { height: 22px; filter: brightness(0) invert(1); }
.logo-roadmap {
  font-family: 'Syne', sans-serif;
  font-size: 1rem;
  font-weight: 700;
  color: #f4a261;
  letter-spacing: 1px;
  text-transform: uppercase;
}

/* ‚îÄ‚îÄ TIMELINE ‚îÄ‚îÄ */
.timeline-wrap {
  background: var(--white);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 24px 28px 20px;
  margin-bottom: 48px;
}
.timeline-title {
  font-family: 'Syne', sans-serif;
  font-size: .65rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 3px;
  color: var(--muted);
  margin-bottom: 16px;
}
.timeline-months-row {
  position: relative;
  height: 18px;
  margin-bottom: 4px;
}
.timeline-month-label {
  position: absolute;
  font-size: .62rem;
  color: var(--muted);
  transform: translateX(-50%);
}
.timeline-today-label {
  position: absolute;
  top: 0;
  font-size: .62rem;
  color: #f4a261;
  font-weight: 700;
  transform: translateX(-50%);
  white-space: nowrap;
}
.timeline-rows {
  position: relative;
  display: flex;
  flex-direction: column;
  gap: 8px;
}
.timeline-row {
  position: relative;
  height: 38px;
}
.timeline-row-bg {
  position: absolute;
  inset: 0;
  display: flex;
}
.timeline-month-sep {
  position: absolute;
  top: 0; bottom: 0;
  width: 1px;
  background: var(--border);
}
.timeline-bar {
  position: absolute;
  top: 0; bottom: 0;
  border-radius: 8px;
  display: flex;
  align-items: center;
  padding: 0 12px;
  font-family: 'Syne', sans-serif;
  font-size: .75rem;
  font-weight: 700;
  white-space: nowrap;
  overflow: hidden;
  cursor: pointer;
  transition: opacity .15s;
}
.timeline-bar:hover { opacity: .82; }
.timeline-bar.past    { background: #e0ddd6; color: #666; }
.timeline-bar.current { background: var(--dark); color: #fff; }
.timeline-bar.future  { background: var(--border); color: var(--dark); border: 1.5px dashed #ccc; }
.timeline-today-line {
  position: absolute;
  top: -4px; bottom: -4px;
  width: 2px;
  background: #f4a261;
  border-radius: 2px;
  z-index: 5;
}

/* ‚îÄ‚îÄ CELL FOOTER (resumo + ver detalhes) ‚îÄ‚îÄ */
.cell-footer {
  padding: 8px 14px;
  display: flex; align-items: center; justify-content: space-between;
  border-top: 1px solid #f5f4f0;
  background: #fafaf8;
  border-radius: 0 0 12px 12px;
}
.hidden-count {
  font-size: .68rem;
  color: var(--muted);
  font-style: italic;
}
.btn-details {
  font-size: .68rem;
  font-family: 'Syne', sans-serif;
  font-weight: 700;
  letter-spacing: .5px;
  color: var(--muted);
  background: none;
  border: none;
  cursor: pointer;
  padding: 3px 8px;
  border-radius: 4px;
  transition: color .15s, background .15s;
}
.btn-details:hover { color: var(--dark); background: var(--border); }

/* ‚îÄ‚îÄ FEATURES TOGGLE ‚îÄ‚îÄ */
.epic-row { cursor: default; }
.epic-toggle-btn {
  background: none; border: none; cursor: pointer;
  padding: 2px 4px; margin-left: 4px;
  color: var(--muted); font-size: .7rem;
  border-radius: 3px;
  line-height: 1;
  flex-shrink: 0;
  transition: color .15s, background .15s;
}
.epic-toggle-btn:hover { color: var(--dark); background: var(--border); }
.epic-chevron { display: inline-block; transition: transform .2s; }
.epic-chevron.open { transform: rotate(90deg); }

/* ‚îÄ‚îÄ FEATURES LIST ‚îÄ‚îÄ */
.epic-features {
  display: none;
  padding: 6px 18px 10px 32px;
  background: #f8f8f6;
  border-top: 1px dashed #ede;
}
.epic-features.expanded { display: block; }
.feature-item {
  display: flex; align-items: flex-start; gap: 7px;
  padding: 3px 0;
  font-size: .73rem;
  color: var(--mid);
  line-height: 1.3;
}
.feature-dot {
  width: 6px; height: 6px;
  border-radius: 50%;
  flex-shrink: 0;
  margin-top: 4px;
}
.feature-dot.st-live      { background: #16a34a; }
.feature-dot.st-released  { background: #22c55e; }
.feature-dot.st-ready-rel { background: #86efac; }
.feature-dot.st-in-dev    { background: #f97316; }
.feature-dot.st-ready-dev { background: #60a5fa; }
.feature-dot.st-analysis  { background: #d1d5db; }
.features-loading { padding: 6px; font-size: .7rem; color: var(--muted); font-style: italic; }

/* ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ */
.modal-overlay {
  position: fixed; inset: 0;
  background: rgba(0,0,0,.45);
  z-index: 200;
  display: flex; align-items: center; justify-content: center;
  opacity: 0; visibility: hidden;
  transition: opacity .2s, visibility .2s;
}
.modal-overlay.open { opacity: 1; visibility: visible; }
.modal-box {
  background: var(--white);
  border-radius: 16px;
  width: 92%; max-width: 700px;
  max-height: 85vh;
  display: flex; flex-direction: column;
  overflow: hidden;
  box-shadow: 0 20px 60px rgba(0,0,0,.2);
}
.modal-header {
  padding: 18px 24px;
  border-bottom: 1px solid var(--border);
  display: flex; align-items: center; justify-content: space-between;
  flex-shrink: 0;
}
.modal-title {
  font-family: 'Syne', sans-serif;
  font-size: .95rem;
  font-weight: 700;
  letter-spacing: -.3px;
}
.modal-close {
  background: none; border: none; cursor: pointer;
  font-size: 1.1rem; color: var(--muted); padding: 4px 8px;
  border-radius: 6px;
  transition: color .15s, background .15s;
}
.modal-close:hover { color: var(--dark); background: var(--border); }
.modal-body {
  overflow-y: auto;
  flex: 1;
}
.modal-section-label {
  font-family: 'Syne', sans-serif;
  font-size: .6rem; font-weight: 700;
  text-transform: uppercase; letter-spacing: 2px;
  color: var(--muted);
  padding: 12px 18px 6px;
  border-bottom: 1px solid #f5f4f0;
}

/* ‚îÄ‚îÄ HIGHLIGHTS (painel de destaques para TV) ‚îÄ‚îÄ */
.highlights-wrap {
  background: var(--dark);
  border-radius: 16px;
  padding: 20px 24px 22px;
  margin-bottom: 40px;
}
.highlights-top {
  display: flex; align-items: center; gap: 12px;
  margin-bottom: 14px;
}
.highlights-title {
  font-family: 'Syne', sans-serif;
  font-size: .58rem; font-weight: 700;
  text-transform: uppercase; letter-spacing: 4px;
  color: #555;
}
.highlights-note {
  font-size: .65rem; color: #444; font-style: italic;
  margin-left: auto;
}
.highlights-scroll {
  display: flex; gap: 10px;
  overflow-x: auto;
  scroll-snap-type: x mandatory;
  padding-bottom: 6px;
  scrollbar-width: thin; scrollbar-color: #333 transparent;
}
.highlights-scroll::-webkit-scrollbar { height: 3px; }
.highlights-scroll::-webkit-scrollbar-thumb { background: #333; border-radius: 2px; }

.hl-meta {
  flex-shrink: 0;
  width: clamp(260px, 28vw, 390px);
  scroll-snap-align: start;
  background: rgba(255,255,255,.05);
  border: 1px solid rgba(255,255,255,.08);
  border-radius: 10px;
  overflow: hidden;
  display: flex; flex-direction: column;
  max-height: min(82vh, 640px);
}
.hl-meta.past { opacity: .6; }
.hl-meta-head {
  padding: 11px 15px;
  display: flex; align-items: center; gap: 8px;
  border-bottom: 1px solid rgba(255,255,255,.07);
  flex-shrink: 0;
}
.hl-meta-num {
  font-family: 'Syne', sans-serif;
  font-size: .95rem; font-weight: 800; color: #fff; letter-spacing: -.5px;
}
.hl-meta-head.current .hl-meta-num { color: #f4a261; }
.hl-meta-period { font-size: .68rem; color: #555; }
.hl-meta-head .meta-pill { margin-left: auto; font-size: .56rem; padding: 2px 7px; }
.hl-squads { padding: 8px 0 4px; overflow-y: auto; flex: 1; }
.hl-squad-block {
  padding-bottom: 6px; margin-bottom: 4px;
  border-bottom: 1px solid rgba(255,255,255,.05);
}
.hl-squad-block:last-child { border-bottom: none; padding-bottom: 2px; margin-bottom: 0; }
.hl-squad-label {
  font-family: 'Syne', sans-serif;
  font-size: .52rem; font-weight: 700;
  text-transform: uppercase; letter-spacing: 1.5px;
  padding: 4px 14px 3px;
  display: flex; align-items: center; gap: 5px;
  cursor: pointer;
  border-radius: 5px;
  transition: background .15s;
  user-select: none;
}
.hl-squad-label:hover { background: rgba(255,255,255,.09); }
.hl-squad-label:active { background: rgba(255,255,255,.14); }
.hl-squad-arrow {
  margin-left: auto;
  font-size: .6rem;
  opacity: 0;
  transition: opacity .15s;
  color: #666;
}
.hl-squad-label:hover .hl-squad-arrow { opacity: 1; }
.hl-squad-dot { width: 5px; height: 5px; border-radius: 50%; flex-shrink: 0; }
.hl-epic {
  display: flex; align-items: flex-start; gap: 7px;
  padding: 3px 14px;
}
.hl-icon { flex-shrink: 0; font-size: .72rem; line-height: 1.5; }
.hl-name {
  font-size: .78rem; color: #ccc; line-height: 1.35;
  display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;
  overflow: hidden;
}
.hl-more {
  font-size: .68rem; color: #555; font-style: italic;
  padding: 2px 14px 4px 35px;
}

/* ‚îÄ‚îÄ MOBILE MATRIX ‚îÄ‚îÄ */
.mobile-matrix { display: none; }

/* ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ */
@media (max-width: 768px) {
  /* Header compacto */
  header { padding: 10px 16px; gap: 8px; }
  .header-date { display: none; }
  .logo-img { height: 18px; }
  .logo-roadmap { font-size: .82rem; }
  .header-btn { padding: 6px 11px; font-size: .73rem; }

  /* Main */
  main { padding: 12px 14px; }

  /* Esconder elementos desktop */
  .timeline-wrap { display: none; }
  .matrix-wrap { display: none; }

  /* Mostrar layout mobile */
  .mobile-matrix { display: block; margin-bottom: 24px; }

  /* Sec√ß√£o de meta */
  .mob-meta-section { margin-bottom: 24px; border-radius: 12px; overflow: hidden; box-shadow: 0 1px 4px rgba(0,0,0,.06); }
  .mob-meta-header {
    background: var(--dark); color: #fff;
    padding: 14px 16px;
    display: flex; align-items: center; gap: 8px; flex-wrap: wrap;
  }
  .mob-meta-header.past    { background: #555; }
  .mob-meta-header.future  { background: #6b7280; }
  .mob-meta-num  { font-family: 'Syne', sans-serif; font-size: 1.05rem; font-weight: 800; letter-spacing: -.4px; }
  .mob-meta-period { font-size: .73rem; color: #aaa; }
  .mob-meta-header .meta-pill { margin-left: auto; font-size: .6rem; padding: 3px 8px; }
  .mob-meta-dates { font-size: .65rem; color: #888; width: 100%; margin-top: -4px; }

  /* Squad dentro da meta */
  .mob-squad-section { border-top: 2px solid var(--bg); }
  .mob-squad-label {
    display: flex; align-items: center; gap: 8px;
    padding: 9px 14px;
    border-left: 3px solid;
    font-family: 'Syne', sans-serif;
    font-size: .68rem; font-weight: 700;
    text-transform: uppercase; letter-spacing: .8px;
    color: var(--dark);
  }
  .mob-epics { border-left: 3px solid; }

  /* √âpico compacto */
  .epic-row { padding: 10px 14px; }
  .epic-name { font-size: .82rem; }
  .epic-status { font-size: .63rem; padding: 2px 6px; }
  .progress-bar { display: none; }
  .progress-pct { font-size: .63rem; }
  .risk-badge { font-size: .62rem; padding: 2px 6px; }
  .epic-toggle-btn { font-size: .65rem; }

  /* Features */
  .epic-features { padding: 4px 12px 8px 24px; }
  .feature-item { font-size: .7rem; }

  /* Footer do card */
  .cell-footer { padding: 6px 12px; }
  .hidden-count { font-size: .63rem; }
  .btn-details { font-size: .63rem; }

  /* Modal */
  .modal-box { width: 97%; max-height: 92vh; border-radius: 12px; }
  .modal-header { padding: 12px 16px; }
  .modal-title { font-size: .85rem; }
}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginScreen">
  <div class="login-box">
    <img src="https://omnibees.com/wp-content/themes/omnibees/assets/img/main-logo.svg" alt="Omnibees" style="height:36px;filter:brightness(0) invert(1);margin-bottom:16px;" />
    <div class="login-title" style="font-size:1.4rem;margin-bottom:2px;">Product <span>Roadmap</span></div>
    <div class="login-sub">Comit√© de Dire√ß√£o ¬∑ Omnibees Product</div>
    <input type="password" class="login-input" id="loginInput" placeholder="password" />
    <button class="login-btn" onclick="doLogin()">Entrar</button>
    <div class="login-error" id="loginError">Password incorreta</div>
  </div>
</div>

<!-- DETAILS MODAL -->
<div id="detailsModal" class="modal-overlay" onclick="if(event.target===this)closeModal()">
  <div class="modal-box">
    <div class="modal-header">
      <span class="modal-title" id="modalTitle"></span>
      <button class="modal-close" onclick="closeModal()">‚úï</button>
    </div>
    <div class="modal-body" id="modalContent"></div>
  </div>
</div>

<!-- APP -->
<div id="app">
  <header>
    <div class="logo">
      <img src="https://omnibees.com/wp-content/themes/omnibees/assets/img/main-logo.svg" alt="Omnibees" class="logo-img" />
      <span class="logo-roadmap">Roadmap</span>
    </div>
    <div class="header-meta">
      <span class="header-date" id="headerDate"></span>
      <span class="header-refresh-info" id="headerRefreshInfo"></span>
      <button class="header-btn" onclick="loadData()">‚Üª Atualizar</button>
      <button class="header-btn" onclick="doLogout()">Sair</button>
    </div>
  </header>

  <main>
    <div class="error-box" id="errorBox"></div>
    <div id="content"><div class="loading"><div class="spinner"></div><p>A carregar roadmap‚Ä¶</p></div></div>
  </main>
</div>

<script>
// ‚îÄ‚îÄ‚îÄ CONFIG ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const SITE_PASSWORD   = 'omnibees2024';
const WORKER_URL      = 'https://lucky-star-d742.ana-g-antunes.workers.dev';
const PIVOT_ID        = '7611561269213679416';
const AUTO_REFRESH_MS = 24 * 60 * 60 * 1000; // 24 horas
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

// ‚îÄ‚îÄ‚îÄ AUTO-REFRESH ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let _autoRefreshTimer = null;

function updateRefreshInfo() {
  const el = document.getElementById('headerRefreshInfo');
  if (!el) return;
  const next = new Date(Date.now() + AUTO_REFRESH_MS);
  el.textContent = `‚Üª pr√≥ximo refresh √†s ${next.toLocaleTimeString('pt-PT', { hour: '2-digit', minute: '2-digit' })}`;
}

function startAutoRefresh() {
  stopAutoRefresh();
  updateRefreshInfo();
  _autoRefreshTimer = setInterval(() => {
    loadData();
    updateRefreshInfo();
  }, AUTO_REFRESH_MS);
}

function stopAutoRefresh() {
  if (_autoRefreshTimer) { clearInterval(_autoRefreshTimer); _autoRefreshTimer = null; }
}

// ‚îÄ‚îÄ‚îÄ AUTH ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function doLogin() {
  if (document.getElementById('loginInput').value === SITE_PASSWORD) {
    document.getElementById('loginScreen').classList.add('hidden');
    document.getElementById('app').style.display = 'block';
    const now = new Date();
    document.getElementById('headerDate').textContent =
      now.toLocaleDateString('pt-PT', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' });
    loadData();
    startAutoRefresh();
  } else {
    document.getElementById('loginError').classList.add('show');
  }
}
document.getElementById('loginInput').addEventListener('keydown', e => { if (e.key === 'Enter') doLogin(); });

function doLogout() {
  stopAutoRefresh();
  document.getElementById('app').style.display = 'none';
  document.getElementById('loginInput').value = '';
  document.getElementById('loginScreen').classList.remove('hidden');
}

// ‚îÄ‚îÄ‚îÄ API ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function ahaGet(path) {
  const res = await fetch(`${WORKER_URL}?path=${encodeURIComponent(path)}`);
  if (!res.ok) throw new Error(`HTTP ${res.status}`);
  return res.json();
}

// ‚îÄ‚îÄ‚îÄ LOAD DATA (pivot √∫nico ‚Üí tudo de uma vez) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function loadData() {
  showLoading();
  try {
    // 1. Uma √∫nica chamada ‚Äî pivot devolve releases + √©picos + estado + progresso + risco
    const pivotData = await ahaGet(`bookmarks/custom_pivots/${PIVOT_ID}`);
    const rows    = pivotData.rows  || {};
    const cells   = pivotData.cells || {};
    const topRows = pivotData.top_level_rows || [];

    // field_definitions: 64=release name, 65=start_date, 66=end_date
    //                    67=priority (Prio Produto), 68=epic name, 69=progress, 70=risk, 71=status
    // Estrutura de rows: nameRow(fd64) ‚Üí child startRow(fd65) ‚Üí child endRow(fd66)
    // cells["0"][releaseIdx][epicIdx] = array de field-values (fd 67,68,69,70)
    const allEpicsGrid = cells['0'] || [];

    const metas = topRows.map((rowRef, idx) => {
      const nameRow    = rows[rowRef] || {};
      const startRef   = nameRow.child_refs?.[0];
      const startRow   = startRef ? (rows[startRef] || {}) : {};
      const endRef     = startRow.child_refs?.[0];
      const endRow     = endRef   ? (rows[endRef]   || {}) : {};

      const releaseRefMatch = (nameRow.html_value || '').match(/\/releases\/([\w-]+)/);

      // √âpicos: cells["0"][idx] ‚Üí array de √©picos; deduplicar por ID
      const epicGroups = allEpicsGrid[idx] || [];
      const seenIds = new Set();
      const epics = epicGroups.map(fieldVals => {
        const byFd = {};
        for (const fv of fieldVals) byFd[fv.field_definition_ref] = fv;

        // field_definitions: 67=priority, 68=epic name, 69=progress, 70=risk, 71=status
        const nameField  = byFd[68];
        const epicId     = nameField?.id || null;
        if (!epicId || seenIds.has(epicId)) return null;
        seenIds.add(epicId);

        const epicName   = nameField?.plain_value || '';
        const epicRef    = (nameField?.html_value || '').match(/\/epics\/([\w-]+)/)?.[1] || null;
        const prioRaw    = byFd[67]?.plain_value;
        const progress   = byFd[69]?.plain_value ?? null;
        const riskVal    = byFd[70]?.plain_value || null;
        const statusName = byFd[71]?.plain_value || null;

        return {
          name: epicName,
          _epicRef: epicRef,
          _releaseRef: releaseRefMatch?.[1] || null,
          _priority: (prioRaw != null && prioRaw !== '') ? Number(prioRaw) : null,
          progress: progress != null ? Math.round(Number(progress)) : null,
          workflow_status: statusName ? { name: statusName } : null,
          _alert: riskVal,
        };
      }).filter(e => e && e.name);

      return {
        name: nameRow.plain_value || '',
        id: releaseRefMatch?.[1] || String(rowRef),
        _releaseRef: releaseRefMatch?.[1],
        epics,
        _start: parseDate(startRow.plain_value),
        _end:   parseDate(endRow.plain_value),
      };
    }).filter(m => m._releaseRef);

    // 2. Agrupar por meta e classificar
    const allGroups = groupMetasByNumber(metas);
    const today = new Date(); today.setHours(0,0,0,0);
    const past = [], current = [], future = [];
    for (const group of allGroups) {
      const s = group._start || new Date(0);
      const e = group._end   || new Date(9999,0);
      if (e < today)       past.push(group);
      else if (s <= today) current.push(group);
      else                 future.push(group);
    }

    renderAll({ past, current, future });
  } catch(err) {
    showError('Erro ao carregar dados: ' + err.message);
  }
}

function parseDate(str) {
  if (!str) return null;
  const d = new Date(str);
  return isNaN(d) ? null : d;
}


// ‚îÄ‚îÄ‚îÄ STATUS CLASSIFICATION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Ordem do workflow Aha! do menos avan√ßado (backlog) ao mais avan√ßado (live).
// group: menor = mais avan√ßado = aparece primeiro na ordena√ß√£o.
const STATUS_CONFIG = [
  { keys: ['live'],                                          group: 0, cls: 'st-live',      icon: 'üü¢' },
  { keys: ['released', 'lan√ßado', 'lan√ßada'],                group: 1, cls: 'st-released',  icon: '‚úÖ' },
  { keys: ['pronto para release', 'ready for release'],      group: 2, cls: 'st-ready-rel', icon: 'üöÄ' },
  { keys: ['em desenvolvimento', 'in development'],          group: 3, cls: 'st-in-dev',    icon: 'üî®' },
  { keys: ['pronto para desenvolvimento', 'ready for development'],
                                                             group: 4, cls: 'st-ready-dev', icon: 'üìê' },
  { keys: ['em especifica√ß√£o final'],                        group: 5, cls: 'st-analysis',  icon: 'üìã' },
  { keys: ['em aprova√ß√£o de escopo'],                        group: 6, cls: 'st-analysis',  icon: 'üìã' },
  { keys: ['em escopo geral'],                               group: 7, cls: 'st-analysis',  icon: 'üìã' },
  { keys: ['backlog de features', 'backlog'],                group: 8, cls: 'st-analysis',  icon: 'üìã' },
  { keys: ['cancelada', 'cancelled', 'cancelado'],           group: 9, cls: 'st-analysis',  icon: 'üìã' },
];

function getStatusInfo(statusName) {
  const key = (statusName || '').toLowerCase().trim();
  for (const cfg of STATUS_CONFIG) {
    if (cfg.keys.some(k => key === k || key.includes(k))) return cfg;
  }
  // Default: desconhecido ‚Üí fim da lista
  return { group: 9, cls: 'st-analysis', icon: '‚ó¶' };
}

// ‚îÄ‚îÄ‚îÄ DELIVERY RISK ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function getRisk(epic) {
  // Check alert from pivot (primary source)
  if (epic._alert) {
    const a = epic._alert.toLowerCase();
    if (a.includes('n√£o planeado') || a.includes('nao planeado')) return 'unplanned';
    if (a.includes('risco'))                                       return 'atrisk';
    if (a.includes('longa') || a.includes('long'))                 return 'long';
  }
  // Fallback: native delivery risk field
  if (epic.due_date_risk) {
    const r = epic.due_date_risk.toLowerCase();
    if (r.includes('unplanned') || r.includes('n√£o planeado')) return 'unplanned';
    if (r.includes('risk') || r.includes('risco'))             return 'atrisk';
    if (r.includes('long') || r.includes('longa'))             return 'long';
  }
  return null;
}

function riskBadge(risk) {
  if (!risk) return '';
  const map = {
    unplanned: ['‚ö† N√£o planeado', 'risk-unplanned'],
    atrisk:    ['‚ö° Em risco',     'risk-atrisk'],
    long:      ['‚è≥ Entrega longa','risk-long'],
  };
  const [label, cls] = map[risk];
  return `<span class="risk-badge ${cls}">${label}</span>`;
}

// ‚îÄ‚îÄ‚îÄ GROUP METAS BY NUMBER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const META_PERIODS = ['Jan/Fev', 'Mar/Abr', 'Mai/Jun', 'Jul/Ago', 'Set/Out', 'Nov/Dez'];

function groupMetasByNumber(metas) {
  const groups = {};
  for (const m of metas) {
    const match = m.name.match(/Meta\s+(\d+)\s+(\d{4})/i);
    if (!match) continue;
    const metaNum = parseInt(match[1]);
    const year    = parseInt(match[2]);
    const key     = `${year}-${String(metaNum).padStart(2,'0')}`;
    if (!groups[key]) {
      groups[key] = {
        metaNum, year, key,
        period: META_PERIODS[metaNum - 1] || '',
        squads: [], _start: null, _end: null
      };
    }
    const squadName = m.name.replace(/^Meta\s+\d+\s+\d{4}\s*[-‚Äì]\s*/i, '').trim() || m.name;
    groups[key].squads.push({ name: squadName, epics: m.epics });
    if (m._start && (!groups[key]._start || m._start < groups[key]._start)) groups[key]._start = m._start;
    if (m._end   && (!groups[key]._end   || m._end   > groups[key]._end))   groups[key]._end   = m._end;
  }
  return Object.values(groups).sort((a, b) =>
    a.year !== b.year ? a.year - b.year : a.metaNum - b.metaNum
  );
}

// ‚îÄ‚îÄ‚îÄ TIMELINE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderTimeline({ past, current, future }) {
  const allGroups = [
    ...past.map(g => ({...g, type:'past'})),
    ...current.map(g => ({...g, type:'current'})),
    ...future.map(g => ({...g, type:'future'}))
  ].sort((a,b) => a.year !== b.year ? a.year - b.year : a.metaNum - b.metaNum);

  if (!allGroups.length) return '';

  // Find the year range from the data
  const year = allGroups[0].year || 2026;
  const yearStart = new Date(year, 0, 1);
  const yearEnd   = new Date(year, 11, 31);
  const totalMs   = yearEnd - yearStart;
  const pct = d => d ? Math.max(0, Math.min(100, ((d - yearStart) / totalMs) * 100)) : null;

  const today    = new Date();
  const todayPct = pct(today);
  const months   = ['Jan','Fev','Mar','Abr','Mai','Jun','Jul','Ago','Set','Out','Nov','Dez'];

  // Month separator lines (reused in each row)
  const sepLines = months.map((_, i) => {
    const p = (i / 12 * 100).toFixed(2);
    return `<div class="timeline-month-sep" style="left:${p}%"></div>`;
  }).join('');

  // Month labels row
  const monthLabels = months.map((m, i) => {
    const p = ((i + 0.5) / 12 * 100).toFixed(2);
    return `<div class="timeline-month-label" style="left:${p}%">${m}</div>`;
  }).join('');

  // Today marker in month labels row
  const todayMarker = todayPct !== null
    ? `<div class="timeline-today-label" style="left:${todayPct.toFixed(2)}%">Hoje</div>`
    : '';

  // One bar per meta group
  const rows = allGroups.map(group => {
    const sp = pct(group._start);
    const ep = pct(group._end);
    if (sp === null || ep === null) return '';
    const w = Math.max(ep - sp, 2).toFixed(2);
    const period = group.period ? ` ¬∑ ${group.period}` : '';
    const todayLine = todayPct !== null
      ? `<div class="timeline-today-line" style="left:${todayPct.toFixed(2)}%"></div>`
      : '';
    return `
      <div class="timeline-row" onclick="document.getElementById('meta-${group.year}-${group.metaNum}')?.scrollIntoView({behavior:'smooth',block:'start'})">
        ${sepLines}
        <div class="timeline-bar ${group.type}" style="left:${sp.toFixed(2)}%;width:${w}%">
          Meta ${group.metaNum}${period}
        </div>
        ${todayLine}
      </div>`;
  }).join('');

  return `
    <div class="timeline-wrap">
      <div class="timeline-title">Cronograma ${year}</div>
      <div style="position:relative">
        <div class="timeline-months-row">${monthLabels}${todayMarker}</div>
        <div class="timeline-rows">${rows}</div>
      </div>
    </div>`;
}

// ‚îÄ‚îÄ‚îÄ SQUAD CONFIG ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const SQUAD_ORDER = [
  'Beehive', 'BeeHive UI', 'Bee2Bee/BeeChannel',
  'BeeConnect/Partners API', 'Vis√£o 360', 'BeePrice', 'BeeDirect'
];

// cor (borda + dot), bg suave, linhas do label
const SQUAD_STYLE = {
  'Beehive':                 { color: '#F59E0B', bg: '#fffbeb', lines: ['Beehive'] },
  'BeeHive UI':              { color: '#FCD34D', bg: '#fefce8', lines: ['BeeHive UI'] },
  'Bee2Bee/BeeChannel':      { color: '#3B82F6', bg: '#eff6ff', lines: ['Bee2Bee', 'BeeChannel'] },
  'BeeConnect/Partners API': { color: '#22C55E', bg: '#f0fdf4', lines: ['BeeConnect', 'Partners API'] },
  'Vis√£o 360':               { color: '#06B6D4', bg: '#ecfeff', lines: ['Vis√£o 360'] },
  'BeePrice':                { color: '#F472B6', bg: '#fdf4ff', lines: ['BeePrice'] },
  'BeeDirect':               { color: '#A78BFA', bg: '#faf5ff', lines: ['BeeDirect'] },
};

// Partial-match aliases: if data has only one part of a combined squad name, map it
const SQUAD_ALIASES = {
  'bee2bee':        'Bee2Bee/BeeChannel',
  'beechannel':     'Bee2Bee/BeeChannel',
  'beeconnect':     'BeeConnect/Partners API',
  'partnersapi':    'BeeConnect/Partners API',
};

function normalizeSquad(name) {
  const n = name.toLowerCase().replace(/[\s\/\-_]/g, '');
  // Exact match first
  const exact = SQUAD_ORDER.find(s => s.toLowerCase().replace(/[\s\/\-_]/g, '') === n);
  if (exact) return exact;
  // Alias match
  const alias = SQUAD_ALIASES[n];
  if (alias) return alias;
  // Partial match: if the normalized name is fully contained in a squad order entry's normalized name
  const partial = SQUAD_ORDER.find(s => s.toLowerCase().replace(/[\s\/\-_]/g, '').includes(n));
  if (partial) return partial;
  return null; // Return null for unknown squads so we can filter them out
}

function isKnownSquad(name) {
  return normalizeSquad(name) !== null;
}

// ‚îÄ‚îÄ‚îÄ RENDER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderAll({ past, current, future }) {
  const allGroups = [
    ...past.map(g => ({...g, type:'past'})),
    ...current.map(g => ({...g, type:'current'})),
    ...future.map(g => ({...g, type:'future'}))
  ].sort((a,b) => a.year !== b.year ? a.year - b.year : a.metaNum - b.metaNum);

  // Collect all unique squad names (normalized), in preferred order
  // Only include squads that are in SQUAD_ORDER (unknown/extra squads are hidden)
  const squadSet = new Set();
  allGroups.forEach(g => g.squads.forEach(s => {
    const norm = normalizeSquad(s.name);
    if (norm) squadSet.add(norm);
  }));
  const squads = SQUAD_ORDER.filter(s => squadSet.has(s));

  // Build lookup: metaKey ‚Üí normalizedSquad ‚Üí {epics, type}
  // If multiple raw squads normalize to same name, merge their epics
  const lookup = {};
  allGroups.forEach(g => {
    const key = `${g.year}-${g.metaNum}`;
    if (!lookup[key]) lookup[key] = {};
    g.squads.forEach(s => {
      const norm = normalizeSquad(s.name);
      if (!norm) return; // skip unknown squads
      if (!lookup[key][norm]) {
        lookup[key][norm] = { epics: [], type: g.type };
      }
      lookup[key][norm].epics.push(...s.epics);
    });
  });

  const html = renderHighlights(allGroups, squads, lookup)
    + renderTimeline({ past, current, future })
    + renderMatrix(allGroups, squads, lookup)
    + renderMobileMatrix(allGroups, squads, lookup);
  document.getElementById('content').innerHTML = html;
}

function renderMatrix(metas, squads, lookup) {
  const numMetas = metas.length;
  // grid: [squad-label] + [meta cols]
  const cols = `180px repeat(${numMetas}, 420px)`;

  const pillMap = {
    past:    ['pill-past',    '‚úì Conclu√≠da'],
    current: ['pill-current', '‚óè Em curso'],
    future:  ['pill-next',    '‚óã A seguir'],
  };

  // Header row
  const headerCells = metas.map(g => {
    const [pillClass, pillLabel] = pillMap[g.type];
    const dates = formatDateRange(g._start, g._end);
    return `
      <div class="matrix-col-header ${g.type}" id="meta-${g.year}-${g.metaNum}">
        <div class="meta-col-num">Meta ${g.metaNum}</div>
        <div class="meta-col-period">${g.period} ${g.year}</div>
        <div class="meta-col-dates">${dates}</div>
        <span class="meta-pill ${pillClass}">${pillLabel}</span>
      </div>`;
  }).join('');

  // Armazenar dados das c√©lulas para o modal
  if (!window.__cellStore) window.__cellStore = {};

  // Data rows
  const dataRows = squads.map(squad => {
    const cells = metas.map(g => {
      const key = `${g.year}-${g.metaNum}`;
      const entry = lookup[key]?.[squad];
      const epics = entry?.epics || [];
      const type  = entry?.type || g.type;
      // Sort: 1¬∫ prioridade (asc, sem prioridade no fim), 2¬∫ status group
      const sorted = [...epics].sort((a, b) => {
        const pa = a._priority != null ? a._priority : Infinity;
        const pb = b._priority != null ? b._priority : Infinity;
        if (pa !== pb) return pa - pb;
        return getStatusInfo(a.workflow_status?.name).group - getStatusInfo(b.workflow_status?.name).group;
      });

      if (!sorted.length) return `<div class="matrix-cell cell-${type}"><div class="matrix-cell-empty">‚Äî</div></div>`;

      // Guardar todos os √©picos no store para o modal
      const cellKey = `${g.year}_${g.metaNum}_${squad.replace(/[^\w]/g,'_')}`;
      window.__cellStore[cellKey] = { label: `Meta ${g.metaNum} ¬∑ ${g.period} ¬∑ ${squad}`, epics: sorted };

      // Vista resumida: ocultar √©picos cujo nome termina em '-'
      const visible = sorted.filter(e => !e.name.trim().endsWith('-'));
      const hidden  = sorted.length - visible.length;

      const epicHtml = visible.map(e => renderEpicRow(e, type)).join('');
      const footer = `
        <div class="cell-footer">
          <span class="hidden-count">${hidden > 0 ? `+${hidden} √©pico${hidden>1?'s':''} no detalhe` : ''}</span>
          <button class="btn-details" onclick="openDetails('${cellKey}')">Ver detalhes ‚Üí</button>
        </div>`;

      return `<div class="matrix-cell cell-${type}" id="cell-${cellKey}">${epicHtml}${footer}</div>`;
    }).join('');

    const sc = SQUAD_STYLE[squad] || { color: '#888', bg: '#fff', lines: [squad] };
    const nameHtml = sc.lines.length > 1
      ? `<span class="squad-name-main">${sc.lines[0]}</span><span class="squad-name-sub">${sc.lines[1]}</span>`
      : `<span class="squad-name">${sc.lines[0]}</span>`;

    return `
      <div class="matrix-squad-label" style="border-left-color:${sc.color}; background:${sc.bg};">
        <div class="squad-color-dot" style="background:${sc.color}"></div>
        <div class="squad-name-wrap">${nameHtml}</div>
      </div>
      ${cells}`;
  }).join('');

  return `
    <div class="matrix-wrap">
      <div class="matrix-grid" style="grid-template-columns:${cols}">
        <div class="matrix-squad-header"></div>
        ${headerCells}
        ${dataRows}
      </div>
    </div>`;
}

// ‚îÄ‚îÄ‚îÄ HIGHLIGHTS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Crit√©rio de selec√ß√£o para destaques.
// Por agora: √©picos com prioridade definida no Aha! aparecem nos destaques.
// Quando tiveres um campo dedicado, basta alterar esta fun√ß√£o.
function isHighlighted(epic) {
  return epic._priority != null;
}

// M√°ximo de √©picos mostrados por squad no painel de destaques.
// Aumenta este valor se quiseres ver mais √©picos por squad.
const HIGHLIGHTS_MAX_PER_SQUAD = 3;

function renderHighlights(metas, squads, lookup) {
  const pillMap = {
    past:    ['pill-past',    '‚úì Conclu√≠da'],
    current: ['pill-current', '‚óè Em curso'],
    future:  ['pill-next',    '‚óã A seguir'],
  };

  const cards = metas.map(g => {
    const [pillClass, pillLabel] = pillMap[g.type];
    let anyEpic = false;

    const squadBlocks = squads.map(squad => {
      const key   = `${g.year}-${g.metaNum}`;
      const entry = lookup[key]?.[squad];
      if (!entry?.epics?.length) return '';

      const allHlEpics = entry.epics
        .filter(e => isHighlighted(e) && !e.name.trim().endsWith('-'))
        .sort((a, b) => {
          const pa = a._priority != null ? a._priority : Infinity;
          const pb = b._priority != null ? b._priority : Infinity;
          if (pa !== pb) return pa - pb;
          return getStatusInfo(a.workflow_status?.name).group - getStatusInfo(b.workflow_status?.name).group;
        });

      if (!allHlEpics.length) return '';
      anyEpic = true;

      const hlEpics  = allHlEpics.slice(0, HIGHLIGHTS_MAX_PER_SQUAD);
      const remaining = allHlEpics.length - hlEpics.length;

      const sc = SQUAD_STYLE[squad] || { color: '#aaa', lines: [squad] };
      const epicsHtml = hlEpics.map(e => {
        const si = getStatusInfo(e.workflow_status?.name);
        return `<div class="hl-epic">
          <span class="hl-icon" title="${e.workflow_status?.name || ''}">${si.icon}</span>
          <span class="hl-name">${e.name}</span>
        </div>`;
      }).join('')
      + (remaining > 0 ? `<div class="hl-more">+${remaining} √©pico${remaining > 1 ? 's' : ''}</div>` : '');

      const hlCellKey = `${g.year}_${g.metaNum}_${squad.replace(/[^\w]/g,'_')}`;
      return `
        <div class="hl-squad-block">
          <div class="hl-squad-label" onclick="scrollToMatrix('${hlCellKey}')" title="Ir para ${sc.lines.join(' / ')} ¬∑ Meta ${g.metaNum}">
            <span class="hl-squad-dot" style="background:${sc.color}"></span>
            <span style="color:${sc.color}">${sc.lines.join(' / ')}</span>
            <span class="hl-squad-arrow">‚Üì</span>
          </div>
          ${epicsHtml}
        </div>`;
    }).join('');

    if (!anyEpic) return '';

    return `
      <div class="hl-meta ${g.type}">
        <div class="hl-meta-head ${g.type}">
          <span class="hl-meta-num">Meta ${g.metaNum}</span>
          <span class="hl-meta-period">${g.period} ${g.year}</span>
          <span class="meta-pill ${pillClass}">${pillLabel}</span>
        </div>
        <div class="hl-squads">${squadBlocks}</div>
      </div>`;
  }).join('');

  if (!cards.trim()) return '';

  return `
    <div class="highlights-wrap">
      <div class="highlights-top">
        <span class="highlights-title">Destaques ¬∑ ${metas[0]?.year || ''}</span>
        <span class="highlights-note">Top ${HIGHLIGHTS_MAX_PER_SQUAD} √©picos por squad ¬∑ ordenados por prioridade</span>
      </div>
      <div class="highlights-scroll">${cards}</div>
    </div>`;
}

// ‚îÄ‚îÄ‚îÄ MOBILE MATRIX (layout vertical: metas ‚Üí squads ‚Üí √©picos) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderMobileMatrix(metas, squads, lookup) {
  const pillMap = {
    past:    ['pill-past',    '‚úì Conclu√≠da'],
    current: ['pill-current', '‚óè Em curso'],
    future:  ['pill-next',    '‚óã A seguir'],
  };

  const sections = metas.map(g => {
    const [pillClass, pillLabel] = pillMap[g.type];
    const dates = formatDateRange(g._start, g._end);

    const squadSections = squads.map(squad => {
      const key  = `${g.year}-${g.metaNum}`;
      const entry = lookup[key]?.[squad];
      if (!entry?.epics?.length) return '';

      const type   = entry.type || g.type;
      const sorted = [...entry.epics].sort((a, b) => {
        const pa = a._priority != null ? a._priority : Infinity;
        const pb = b._priority != null ? b._priority : Infinity;
        if (pa !== pb) return pa - pb;
        return getStatusInfo(a.workflow_status?.name).group - getStatusInfo(b.workflow_status?.name).group;
      });

      const cellKey = `${g.year}_${g.metaNum}_${squad.replace(/[^\w]/g,'_')}`;
      window.__cellStore[cellKey] = { label: `Meta ${g.metaNum} ¬∑ ${g.period} ¬∑ ${squad}`, epics: sorted };

      const visible = sorted.filter(e => !e.name.trim().endsWith('-'));
      const hidden  = sorted.length - visible.length;
      const sc = SQUAD_STYLE[squad] || { color: '#888', bg: '#fff', lines: [squad] };
      const squadLabel = sc.lines.join(' / ');

      const epicHtml = visible.map(e => renderEpicRow(e, type)).join('');
      const footer = `
        <div class="cell-footer">
          <span class="hidden-count">${hidden > 0 ? `+${hidden} √©pico${hidden>1?'s':''} no detalhe` : ''}</span>
          <button class="btn-details" onclick="openDetails('${cellKey}')">Ver detalhes ‚Üí</button>
        </div>`;

      return `
        <div class="mob-squad-section">
          <div class="mob-squad-label" style="border-left-color:${sc.color}; background:${sc.bg}">
            <div class="squad-color-dot" style="background:${sc.color}"></div>
            ${squadLabel}
          </div>
          <div class="mob-epics" style="border-left-color:${sc.color}; background:${sc.bg}">
            ${epicHtml}${footer}
          </div>
        </div>`;
    }).join('');

    if (!squadSections.trim()) return '';

    return `
      <div class="mob-meta-section">
        <div class="mob-meta-header ${g.type}">
          <span class="mob-meta-num">Meta ${g.metaNum}</span>
          <span class="mob-meta-period">${g.period} ${g.year}</span>
          <span class="meta-pill ${pillClass}">${pillLabel}</span>
          ${dates ? `<span class="mob-meta-dates">${dates}</span>` : ''}
        </div>
        ${squadSections}
      </div>`;
  }).join('');

  return `<div class="mobile-matrix">${sections}</div>`;
}

function renderEpicRow(epic, type) {
  const status   = epic.workflow_status?.name || '‚Äî';
  const progress = epic.progress != null ? Math.round(epic.progress) : null;
  const risk     = getRisk(epic);
  const stInfo   = getStatusInfo(status);
  const toggleBtn = epic._epicRef
    ? `<button class="epic-toggle-btn" title="Ver features" onclick="toggleFeatures(this,'${epic._epicRef}','${epic._releaseRef||''}')"><span class="epic-chevron">‚ñ∂</span></button>`
    : '';

  return `
    <div class="epic-row ${stInfo.cls}">
      <div class="epic-top">
        <span class="epic-name">${epic.name}</span>
        ${riskBadge(risk)}
        ${toggleBtn}
      </div>
      <div class="epic-bottom">
        <span class="epic-status">${stInfo.icon} ${status}</span>
        ${progress !== null ? `
          <div class="progress-bar"><div class="progress-fill" style="width:${progress}%"></div></div>
          <span class="progress-pct">${progress}%</span>
        ` : ''}
      </div>
    </div>`;
}

// ‚îÄ‚îÄ‚îÄ SCROLL TO MATRIX CELL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function scrollToMatrix(cellKey) {
  const cell = document.getElementById('cell-' + cellKey);
  if (!cell) return;

  // scrollIntoView handles vertical (window) + horizontal (matrix-wrap) simultaneously
  cell.scrollIntoView({ behavior: 'smooth', block: 'center', inline: 'center' });

  // Flash highlight after scroll settles
  setTimeout(() => {
    cell.classList.remove('cell-highlight'); // reset if re-triggered
    void cell.offsetWidth;                   // force reflow to restart CSS animation
    cell.classList.add('cell-highlight');
    setTimeout(() => cell.classList.remove('cell-highlight'), 1700);
  }, 700);
}

// ‚îÄ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function openDetails(cellKey) {
  const data = window.__cellStore?.[cellKey];
  if (!data) return;
  document.getElementById('modalTitle').textContent = data.label;
  // Mostrar TODOS os √©picos (incluindo os que terminam em '-')
  const grouped = {
    visible: data.epics.filter(e => !e.name.trim().endsWith('-')),
    hidden:  data.epics.filter(e => e.name.trim().endsWith('-')),
  };
  let html = grouped.visible.map(e => renderEpicRow(e, 'modal')).join('');
  if (grouped.hidden.length) {
    html += `<div class="modal-section-label">√âpicos de suporte</div>`;
    html += grouped.hidden.map(e => renderEpicRow(e, 'modal')).join('');
  }
  document.getElementById('modalContent').innerHTML = html;
  document.getElementById('detailsModal').classList.add('open');
}

function closeModal() {
  document.getElementById('detailsModal').classList.remove('open');
}

// Fechar modal com Escape
document.addEventListener('keydown', e => { if (e.key === 'Escape') closeModal(); });

// ‚îÄ‚îÄ‚îÄ FEATURES (expand√≠vel por √©pico) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const _featCache = {};

async function toggleFeatures(btn, epicRef, releaseRef) {
  const row = btn.closest('.epic-row');
  if (!row) return;
  const chevron = btn.querySelector('.epic-chevron');

  // Procurar ou criar o container de features
  let featsEl = row.nextElementSibling;
  if (!featsEl || !featsEl.classList.contains('epic-features')) {
    featsEl = document.createElement('div');
    featsEl.className = 'epic-features';
    row.after(featsEl);
  }

  const isOpen = featsEl.classList.contains('expanded');
  chevron?.classList.toggle('open', !isOpen);
  if (isOpen) { featsEl.classList.remove('expanded'); return; }
  featsEl.classList.add('expanded');

  if (featsEl.dataset.loaded) return; // j√° carregadas

  featsEl.innerHTML = '<div class="features-loading">A carregar features‚Ä¶</div>';
  try {
    // Cache por √©pico+release para n√£o repetir chamadas
    const cacheKey = `${epicRef}__${releaseRef || 'all'}`;
    if (!_featCache[cacheKey]) {
      const d = await ahaGet(`epics/${epicRef}/features?fields=name,workflow_status,progress,release&per_page=200`);
      const all = d.features || [];
      // Filtrar apenas as features que pertencem √† release desta meta
      _featCache[cacheKey] = releaseRef
        ? all.filter(f => (f.release?.reference_num || '') === releaseRef)
        : all;
    }
    const features = _featCache[cacheKey];
    featsEl.dataset.loaded = '1';
    featsEl.innerHTML = features.length
      ? features.map(f => {
          const si = getStatusInfo(f.workflow_status?.name);
          const p  = f.progress != null ? ` <span style="color:var(--muted);font-size:.68rem">${Math.round(f.progress)}%</span>` : '';
          return `<div class="feature-item"><span class="feature-dot ${si.cls}" title="${f.workflow_status?.name || '‚Äî'}"></span><span class="feature-name">${f.name}${p}</span></div>`;
        }).join('')
      : '<div class="feature-item" style="color:var(--muted);font-style:italic">Sem features nesta meta</div>';
  } catch(err) {
    featsEl.innerHTML = '<div class="feature-item" style="color:var(--risk-red)">Erro ao carregar</div>';
  }
}

// ‚îÄ‚îÄ‚îÄ HELPERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function formatDateRange(start, end) {
  const fmt = d => d ? d.toLocaleDateString('pt-PT', { day: 'numeric', month: 'short', year: 'numeric' }) : '?';
  if (start && end) return `${fmt(start)} ‚Üí ${fmt(end)}`;
  if (start) return `A partir de ${fmt(start)}`;
  if (end)   return `At√© ${fmt(end)}`;
  return '';
}

function showLoading() {
  document.getElementById('content').innerHTML =
    '<div class="loading"><div class="spinner"></div><p>A carregar roadmap‚Ä¶</p></div>';
  document.getElementById('errorBox').classList.remove('show');
}

function showError(msg) {
  document.getElementById('errorBox').textContent = msg;
  document.getElementById('errorBox').classList.add('show');
  document.getElementById('content').innerHTML = '';
}
</script>
</body>
</html>
